---
title: Piggybacking Off of GitHub's Image Cache for Fun and Profit
topic: JavaScript
date: 2024-07-15T14:12:07.317Z
lastModified: 2024-07-15T14:13:30.874Z
description: |
    I don't wanna pay for a CDN just to serve the badge images on my about page on this website. But if my about page is statically generated from my GitHub profile readme, then why not just piggyback off of their Camo CDN cache?
draft: true
type: post
keywords:
    - github
    - cdn
    - cache
    - image
    - optimization
    - ssg
---

When I was first remaking my personal site (the one you're on right now), I decided I wanted to solve one of the major annoyances I've had with my [about page](https://amydev.me/about).

For some context, the about page is statically generated from my [GitHub profile `README.md`](https://github.com/amydevs) for the sake of my laziness. I use little GitHub profile badges that kind of look like this:

![readme profile](/blog/2024-07-15-piggyback-gh-camo/about.png)

To do this, I use a `getStaticProps` function to fetch my GitHub profile `README.md` and serialize it using `next-mdx-remote`:

```tsx
export async function getStaticProps() {
  const repo = `${env.NEXT_PUBLIC_GH_USER}/${env.NEXT_PUBLIC_GH_USER}`;
  const res = await fetch(`https://raw.githubusercontent.com/${repo}/master/README.md`);
  const source = await res.text();
  const mdxSource = await serialize(source, { mdxOptions: { format: "md", rehypePlugins: [rehypeRaw] } });
  return { props: { mdxSource } }
}
```

Then, by utilizing `MDXRemote` and `@tailwindcss/typography`, I can render the markdown content with support for dark mode:

```tsx
function About({
  mdxSource
}: InferGetStaticPropsType<typeof getStaticProps>) {
  return <div suppressHydrationWarning className="prose dark:prose-invert prose-img:inline prose-img:m-0">
    <MDXRemote {...mdxSource} />
  </div>
}
```

But the badge icon images take forever to load! What do I do?!?!

![about page loads so slowly](/blog/2024-07-15-piggyback-gh-camo/slow_load.gif)

This happens because the images are being served directly from source, which presumably has no CDN to catch potential cache hits. When you view a `README.md` on GitHub, it uses an image reverse proxy with an image caching layer to make it so snappy.

So the solution is to implement image caching. But how?

Ah right, silly me. I'm using Next.js, which means I should be able to take advantage of the `next/image` package for image optimization/caching right?

Well when I first started working on this site, I had the brilliant idea of wanting it to be hosted on GitHub pages so that all my individual repository-specific pages will be routed by GitHub automagically. So unfortunately, I can't take advantage of Vercel's image caching with `next/image`.

## Cloudflare?

Well the fantastic thing about the `next/image` package, is that it supports a variety of custom "loaders" that allow for different CDNs do be used for image caching.

Well I've been wanting to switch over to using Cloudflare nameservers for a long while. So I might as well make the switch and get a CDN along with it, right?

So I logged into my dashboard, went over to NameCheap, and pointed my nameservers to CloudFlare, and...


## Piggybacking Off GitHub's Own CDN